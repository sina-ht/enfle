***************************************************

     Simple Plugin-based Graphic Loader Enfle
			*** DEVELOPING VERSION ***

 (C)Copyright 1998, 99, 2000, 2001 by Hiroshi Takekawa.

     Last Modified: Mon Sep  3 10:39:15 2001.

 This file is part of Enfle.

 Enfle is free software; you can redistribute it and/or modify it
 under the terms of the GNU General Public License version 2 as
 published by the Free Software Foundation.

 Enfle is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with this program; if not, write to the Free Software
 Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA

 ATTENTION: GPL version 2 only. You cannot apply any later
 version. This situation may change.

***************************************************

 JPEG Loader plugin and JPEG Saver plugin are based in part on the
 work of the Independent JPEG Group

 -- libjpeg is only linked, not distributed with this archive. You
 -- should install it.

 The Graphics Interchange Format(c) is
 the Copyright property of CompuServe Incorporated.
 GIF(sm) is a Service Mark property of CompuServe Incorporated.

 -- libungif is only linked, not distributed with this
 -- archive. Moreover, libungif is not used by default, for avoiding
 -- possible patent infringement. It's up to you whether use it or not.

 It seems I should include this sentence: "This product includes
 software developed by or derived from software developed by Project
 Mayo". Strictly speaking, Enfle and OpenDivX plugin itself don't
 include software by them. OpenDivX plugin will be dynamically linked
 with libdivxdecore. I'm not sure this plugin is regarded as "Larger
 Work". But it doesn't matter because this plugin can be and is
 released under GPL. See plugins/player/opendivx/opendivx.c for detail.

 This archive includes mpglib by Michael Hipp. Read lib/mpglib/README.

 This software includes libmpeg2 by Aaron Holtzman. For this part, you
 can apply GPL2 or later version.

 This archive includes fnmatch.[ch] by FSF. These files can be
 distributed under GPL2 or (at your option) any later version.

***************************************************

OK, legal part is over. The rest is fun.

Enfle is a clipped form of Enfleurage. Enfleurage means: A process of
extracting perfumes by exposing absorbents, as fixed oils or fats, to
the exhalations of the flowers. It is used for plants whose volatile
oils are too delicate to be separated by distillation. (Webster's
Revised Unabridged Dictionary (1913)).

See README.e if you don't read Japanese, but English.


1.はじめに

このプログラムは、たくさんの画像をさくさく見ることを目標とした画像ロー
ダです。ガンマ補正、拡大縮小、90度回転、軸対称変換などが行えます。動画
にも対応しています。

 対応フォーマット
 BMP, GIF, JPEG, PCX, PNG, PNM
 spi(不安定, Susie pluginを利用できる)
 animated GIF
 mng
 mpeg(mpeg1, mpeg2)
 avi,asf(avifileがWindowsのDLLを利用)
 DivX in AVI format supported by divx4linux

各フォーマットへの対応はプラグインによって実装されております。画像の他
に特殊なアーカイブ、tarなどの一般的なアーカイブ、圧縮されたgzなどのファ
イルなどへの対応もプラグインによって実装されており、公開されている仕様
を参考にすることにより（開発バージョンのドキュメントはまだなし）、誰で
もプラグインを作って拡張することが可能です。

***
GIFのdecodeにはLZWのdecodeが必要ですが、patent(特許)の問題があるので、
enfleのコード自体にはLZW decoderは含まれておりません。decodeには特許は
及ばないというのが大方の見方ですがpatent holderであるUnisysが否定して
いるので一応含まないでおきます。libungifを使うungifプラグインが含まれ
ていますが、ungifプラグイン自体はLZW関連のcodeを含んでいません。ただし、
libungifのLZW codeを使用できるかどうかとは別ですので、各自の責任におい
て使用してください。ungif pluginを利用するには、configure時に
--with-ungifを明示的に指定する必要があります。
***

以下のpluginにはlibraryが別途必要です。動作するであろうversionを書いて
おきます。

JPEG: jpegsrc-6b (libjpeg)
PNG: libpng-1.0.2 or later (recommended: 1.0.9 or 1.2.0)
gz: zlib-1.1.3 or later
bz2: bzip2-1.0.0 or later
ungif: libungif-3.1.0 or later でとりあえず動作しますが、現時点で最新の4.1.0にもバグがあります。
       (recommended: cvs version)
mng: libmng-1.0.0 or later
libmpeg3: libmpeg3-1.2.2 or later
mpeg_lib: mpeg_lib-1.3.1+patch (パッチが必要な場合は私までどうぞ)
avifile: avifile-0.53.5
opendivx: divx4linux-20010807


2.動作環境

Xサーバのdepthが 16, 24(bpp 24, 32)では動くと思われます。その他はいま
のところunsupportedです。今あげたdepthで表示できなかった場合はxdpyinfo
の出力と詳しい環境をお知らせください。なお、depth 16のmaskが
0xf800,0x7e0,0x1f でない場合ばけると思われます。今のところこれは仕様で
すが、そのうち改善されるかもしれません。

今のところ以下の環境での動作が確認されています。

Linux (kernel 2.2 or 2.4 + glibc-2.1 or 2.2, x86)
FreeBSD (4.1R, x86)

同じ/他の環境下で試された方は結果を御報告ください。

私のメインの開発環境は2001/09/03現在 以下の通りです。

Kernel: Linux-2.4.8-ac11
CPU: PentiumIII/1GHz
X server: XFree86-4.1.0
Video: Matrox Millennium G450 DH/AGP 16M
Compiler: gcc version 2.95.3
libc: glibc-2.2.4


3.コンパイル

コンパイルにはgccが必要です。コードにgccのextensionを使っています。
~~~~~~~~~~~~~~~~~~~~~~~~~~~
基本はconfigure して make するだけです。うまくいかない際には、どのよう
なエラーがでたか報告していただければ幸いです。configureが生成する
config.logなども参考になります。報告先は後述してあります。

makeが通ったら、make installするか、srcに移動してenfle.rcを編集して
./enfleと起動してください。

configureスクリプトの指定できるオプションは、./configure --helpで詳細
がみれます。MMXが使えて、かつ、nasmがinstallされていて、しかもdepth16
で使いたいという場合には、--enable-nasmとするといいかもしれません。

プラグインはshared objectとしてcompileされます。ファイル名は.soでおわっ
ている必要があります。compileは通るが.so以外になってしまって動かないと
いう方がいらっしゃいましたら御一報ください。ただし.aができている場合に
はshared objectが作れない/使えない環境である可能性もあります。

susieのpluginを使いたい場合には--enable-spiが必要です。
ungif pluginを使いたい場合には--with-ungifが必要です。


4.コマンドライン

Enfleは非常にシンプルなプログラムです。引数に表示したいファイル名を続
けて指定するだけです。ディレクトリを指定した場合はその下のファイルを再
帰的に追加します。対応してるアーカイブを指定した場合には、その中味も読
まれます。

オプション:

-Cはbatch作業で自動変換します。引数でSaver pluginの名前を指定できます。
省略するとPNGになります。
-iは指定したパターンのファイル名のみ対象とします。
-xは指定したパターンのファイル名を対象から外します。
-wは最初に読みこんだ画像を壁紙にして終了します。
-mは拡大表示方法を指定します。
  0: normal 1: double 2: short 3: long
-cはconfigの上書きをします。複数指定可。


5.使い方

左クリック,n,space	次の画像へ
右クリック,b		前の画像へ
中クリック,N		次のアーカイブへ
d			今表示してるファイルを表示リストからはずす
D(shift+d)		今表示してるファイルを削除する
q			終了
f			フルスクリーンon/off
S(shift+s)		拡大アルゴリズムの変更(nointerpolate/bilinear)
C-s			表示中の画像をPNG形式で保存
Alt-S			configで指定した形式で保存
h,v			それぞれ水平、垂直方向の軸に対して線対称に変換
l,r			それぞれ90度、-90度に回転変換
m			2倍拡大
M(shift+m)		画像の長辺が画面いっぱいになるように拡大
Alt-m			画像の短辺が画面いっぱいになるように拡大
1-3,5-7			ガンマ補正。それぞれ、2.2, 1.7, 1.45, 1/1.45, 1/1.7, 1/2.2。
			繰り返すとどんどん重ねて行われる
4			画像を元に戻す

また、全ての画像を表示し終わっても終了します。

マウスのwheelにも対応しています。今のところ、前にまわすと次の画像、後
にまわすと前の画像にうつります。


6.カスタマイズ

installすると$prefix/share/enfle/enfle.rc(だいたい
/usr/local/share/enfle/enfle.rcとかそのあたり)という設定ファイルが
installされます。カスタマイズするには、

mkdir ~/.enfle
cp /usr/share/enfle/enfle.rc ~/.enfle/config

とコピーして~/.enfle/configを書きかえてください。


7.その他

w3mの外部ビューアとしてenfleを使う方法

~/.mailcap に
image/*;enfle %s
なんて感じに書いてください。システム全体でenfleにしてやるぜ、という方は
/etc/mailcapにでも書いてください。


8.連絡先

バグの報告、御意見、御感想は歓迎します。Enfleに関するMLがあるので、そ
ちらをご利用ください。自動登録となります。講読するには、

 subscribe あなたの名前

とだけ本文に書いて、<enfle-ctl@fennel.org>に送ってください。

 例: subscribe Hiroshi Takekawa

その後折り返し届いたメールにしたがってconfirm(登録の確認)をしてくださ
い。投稿されたメールは私に各種権利があるものとします。(ログの公開、検
索の提供等を楽にするためくらいの意味しかないです)

どうしてもという場合には私に直接でも結構です。

        Hiroshi Takekawa <sian@big.or.jp>
                         <sian@fennel.org>


9.配布について

EnfleはGNU GENERAL PUBLIC LICENSE Version 2に従います。Version 2のみで、
それ以降のVersionにするオプションはいまのところありません。GPL2につい
てはCOPYINGをお読みください。補助として日本語訳COPYING.jもつけてありま
す。
